@app.route("/admin/pending-tasks")
def pending_tasks():
    conn=db(); c=conn.cursor()
    c.execute("""
    SELECT ts.id, u.name, t.title, t.reward
    FROM task_submissions ts
    JOIN users u ON ts.user_id=u.id
    JOIN tasks t ON ts.task_id=t.id
    WHERE ts.status='pending'
    """)
    data=c.fetchall()
    conn.close()
    return jsonify(data)

@app.route("/admin/approve-task/<int:id>")
def approve_task(id):
    conn=db(); c=conn.cursor()
    c.execute("""
    SELECT user_id, task_id FROM task_submissions WHERE id=?
    """,(id,))
    r=c.fetchone()
    if not r: return "not found"

    user_id, task_id=r
    c.execute("SELECT reward FROM tasks WHERE id=?", (task_id,))
    reward=c.fetchone()[0]

    c.execute("UPDATE users SET balance=balance+? WHERE id=?",(reward,user_id))
    c.execute("UPDATE task_submissions SET status='approved' WHERE id=?",(id,))
    conn.commit(); conn.close()
    return jsonify({"status":"approved"})
